!function(){function e(e){this.routes=e,this.init()}function t(e,t){this.name=e,this.htmlName=t}e.prototype={init:function(){var t=this.routes;window.addEventListener("hashchange",function(e){this.selectPath(this,t)}.bind(this)),this.selectPath(this,t)},selectPath:function(t,e){window.location.hash&&e.forEach(function(e){e.isActiveRoute(window.location.hash)&&t.renderView(e.htmlName)})},renderView:function(e){fetch("https://rawgit.com/NastyaNasalevich/Templates-for-chat/master/"+e).then(function(e){return e.text()}).then(function(e){document.getElementById("main-body").innerHTML=e}).then(function(e){document.getElementById("config-resultScript")?config.createPage():document.getElementById("dashboard-users-list")&&(panelOfUsers.initPanelOfUsersElements(),panelOfUsers.createUserList(),setInterval(panelOfUsers.updateUserList,5e3))}.bind(this))}},t.prototype.isActiveRoute=function(e){return e.substr(1)===this.name};new e([new t("configurator","config.html"),new t("dashboard","dashboard.html"),new t("about","about.html")])}();var config=function(){var e=["config-title","config-botName","config-url","config-cssClass","config-position","config-allowMinimize","config-allowDrag","config-requireName","config-showDate","config-xhr","config-fetch","config-resultScript"],t={};function n(){t["config-resultScript"].innerHTML="&ltscript src='https://rawgit.com/NastyaNasalevich/js--touchsoft/task-02/NastyaNasalevich/my.js?'title='"+t["config-title"].value+"'&botName='"+t["config-botName"].value+"'&chatUrl='"+t["config-url"].value+"'&cssClass='"+t["config-cssClass"].value+"'&position='"+t["config-position"].value+"'&allowMinimize='"+t["config-allowMinimize"].checked+"'&allowDrag='"+t["config-allowDrag"].checked+"'&showDateTime='"+t["config-showDate"].checked+"'&requireName='"+t["config-requireName"].checked+"'&requests='"+(t["config-xhr"].checked?"XHR'":"fetch'")+"&gt&lt/script&gt"}function s(){}return s.prototype.createPage=function(){e.forEach(function(e){t[e]=document.getElementById(e),t[e].addEventListener("input",n)}),n()},new s}(),panelOfUsers=function(){var i,r,t,c;function n(e,t){var n=document.createElement("div"),s=document.createElement("div"),a=document.createElement("div"),o=document.createElement("div");s.classList.add("user-name-element"),a.classList.add("user-status-element"),o.classList.add("chat-state-element"),s.innerHTML=e.userName?e.userName:"Anonymous",e.isChatHidden?o.innerHTML=" - ":o.innerHTML="[ ]",e.isRead||s.classList.add("unread-state"),new Date-new Date(e.lastMessageDate)<=6e5&&(a.innerHTML="online"),n.appendChild(o),n.appendChild(a),n.appendChild(s),"User Name"===r.value?sorter.sortByUserName(n,i):"Online"===r.value?sorter.sortByOnline(n,i):"Chat state"===r.value?sorter.sortByChatState(n,i):i.appendChild(n),n.addEventListener("click",function(){c=t,operatorsChat.openChat(t),document.getElementById("active").innerHTML="Active:   "+s.innerHTML,s.classList.add("read-state")})}function e(){}return e.prototype.initPanelOfUsersElements=function(){var e=document.getElementById("dashboard-close");r=document.getElementById("dashboard-sorter"),i=document.getElementById("dashboard-users-list"),t=document.getElementById("dashboard-filter"),r.addEventListener("change",function(){removeChildren(i),panelOfUsers.createUserList()}),t.addEventListener("keyup",function(){filter.filterUsers(document.getElementById("dashboard-filter").value,i.childNodes)}),e.addEventListener("click",function(){document.getElementById("dashboard-work-place").hidden=!0,document.getElementById("dashboard-picture").hidden=!1})},e.prototype.createUserList=function(){sendRequestToDatabase("GET","users/","").then(function(t){Object.keys(t).forEach(function(e){n(t[e],e)})})},e.prototype.updateUserList=function(){sendRequestToDatabase("GET","users/","").then(function(t){removeChildren(i),Object.keys(t).forEach(function(e){n(t[e],e),c&&operatorsChat.addHistoryToPage(c)})}).then(function(){filter.filterUsers(document.getElementById("dashboard-filter").value,i.childNodes)})},new e}(),operatorsChat=function(){function e(){}return e.prototype.openChat=function(a){document.getElementById("dashboard-work-place").hidden=!1,document.getElementById("dashboard-picture").hidden=!0,sendRequestToDatabase("PUT","users/"+a,"/isRead",!0),operatorsChat.addHistoryToPage(a),document.getElementById("dashboard-chat-textarea").addEventListener("click",function(){sendRequestToDatabase("PUT","users/"+a,"/isRead",!0)}),document.getElementById("dashboard-chat-button").addEventListener("click",function(){var e,t,n,s;e=a,t=document.getElementById("dashboard-chat-textarea"),n=t.value,s=new Message(new Date,"Operator",n),document.getElementById("dashboard-history-panel").innerHTML+="<br>"+s.showMessage(),sendRequestToDatabase("POST","messages/",e,s),t.value=""})},e.prototype.addHistoryToPage=function(e){sendRequestToDatabase("GET","messages/",e).then(function(t){var n;document.getElementById("dashboard-history-panel").innerHTML="",t&&Object.keys(t).forEach(function(e){n=new Message(new Date(t[e].time),t[e].sender,t[e].body),document.getElementById("dashboard-history-panel").innerHTML+="<br>"+n.showMessage()})})},new e}(),sorter=function(){function e(){}return e.prototype.sortByUserName=function(e,t){var n,s=!0,a=e.getElementsByClassName("user-name-element")[0].innerHTML;for(n=0;n<t.childNodes.length;n++)if(a<=t.childNodes[n].getElementsByClassName("user-name-element")[0].innerHTML){t.insertBefore(e,t.childNodes[n]),s=!1;break}s&&t.appendChild(e)},e.prototype.sortByOnline=function(e,t){var n,s=!0,a=e.getElementsByClassName("user-status-element")[0].innerHTML;for(n=0;n<t.childNodes.length;n++)if("online"===a){t.insertBefore(e,t.childNodes[n]),s=!1;break}s&&t.appendChild(e)},e.prototype.sortByChatState=function(e,t){var n,s=!0,a=e.getElementsByClassName("chat-state-element")[0].innerHTML;for(n=0;n<t.childNodes.length;n++)if("[ ]"===a){t.insertBefore(e,t.childNodes[n]),s=!1;break}s&&t.appendChild(e)},new e}(),filter=function(){function e(){}return e.prototype.filterUsers=function(e,t){var n=e.toLowerCase();""!==n&&(t.forEach(function(e){e.hidden=!1}),t.forEach(function(e){-1===e.getElementsByClassName("user-name-element")[0].innerHTML.toLowerCase().lastIndexOf(n)&&(e.hidden=!0)}))},new e}();function sendRequestToDatabase(e,t,n,s){return fetch("https://mychat-b0091.firebaseio.com/"+t+n+".json",{headers:{Accept:"application/json","Content-Type":"application/json"},method:e,body:JSON.stringify(s)}).then(function(e){return e.json()}).catch(function(e){console.log("There has been a problem with your fetch operation: ",e.message)})}function Message(e,t,n){this.time=e,this.sender=t,this.body=n}function removeChildren(e){for(;e.lastChild;)e.removeChild(e.lastChild)}Message.prototype.showMessage=function(){return this.time.toLocaleString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric"})+" <br>"+this.sender+": "+this.body+"<br>"};
//# sourceMappingURL=main.js.map
